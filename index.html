<!doctype html>
<html lang="es">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CARTA-DE-NO-ADEUDO_XXXXXXXX</title>
  <style>
    /* =======================
       CONFIGURACIÓN GLOBAL
    ======================= */
    @page{
      size: Letter;   /* 21.59 cm x 27.94 cm */
      margin: 0;
    }

    body{
      margin:0;
      background:#f5f5f5;
      font-family: "Noto Sans", Arial, Helvetica, sans-serif; /* ✅ */
      line-height:1.6;
      color:#222;
    }

    /* =======================
       HOJA LETTER (DOCUMENTO)
    ======================= */
    .hoja{
      width:21.59cm;
      height:27.94cm;
      margin:40px auto;
      background:#fff;
    
      /* ✅ deja espacio para el header “tipo Word” */
      padding:3.6cm 2cm 2.5cm;
    
      box-sizing:border-box;
      position:relative;
      overflow:hidden;
      border-radius:0;
      box-shadow:none;
    }
    
    /* ✅ HEADER REAL (arriba, fuera del flujo) */
    .doc-header{
      position:absolute;
      top:1.2cm;
      left:2cm;
      right:2cm;
    
      margin:0;
      opacity:.78;     /* ✅ menos sólido */
    }
    
    /* tu layout actual sirve */
    .header-top{
      display:flex;
      justify-content:flex-end;
      align-items:flex-start;
      margin-bottom:10px;
    }
    
    .logo{
      max-width:150px;
      height:auto;
      display:block;
    }

    /* =======================
       CONTENIDO DE CARTA
    ======================= */
    .fecha{
      text-align:right;
      white-space:nowrap;
      font-size:8.64pt;
      color:#555;
      letter-spacing:.2px;
      font-style: italic;
      margin-bottom:10px;
    }

    .titulo{
      text-align:center;
      margin:50px 0 26px;
      padding:10px 14px;
      font-weight:400;
      font-size:15pt;
      text-decoration:underline;
    }

    .saludo{
      margin:10px 0 18px;
      font-weight:700;
      font-size:10.5pt;
    }

    .cuerpo{
      font-size:9.75pt;
    }

    .cuerpo p{
      margin:0 0 14px;
      text-align:justify;
    }

    .despedida{
      margin-top:24px;
      font-size:10.5pt;
      text-align:right;
    }

    /* =======================
       FIRMA (IMAGEN)
    ======================= */
    .firma{
      margin-top: 46px;
      text-align:center;
    }

    .firma-img{
      max-width: 230px;  /* ajusta tamaño firma */
      height:auto;
      display:block;
      margin: 0 auto 6px;
    }

    .firma-nombre{
      font-weight:700;
      font-size:11.5px;
      margin-top:2px;
    }

    .firma-cargo{
      font-size:11px;
      margin-top:2px;
    }

    .nota{
      margin-top: 18px;
    }

    .nota small{
      display:block;
      color:#666;
      font-size:8.25pt;
      line-height:1.35;
      text-align:justify;
    }

    /* =======================
       UI FORMULARIO (SIN CAMBIOS)
    ======================= */
    .app-bar{
      max-width:780px;
      margin:40px auto 0;
      padding:0 12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }

    .brand{
      font-weight:800;
      letter-spacing:.2px;
      color:#111;
    }

    .panel{
      max-width:780px;
      margin:12px auto 0;
      background:#fff;
      border-radius:10px;
      box-shadow:0 8px 20px rgba(0,0,0,.08);
      padding:20px 18px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }

    @media (max-width: 760px){
      .grid{ grid-template-columns: 1fr; }
    }

    /* =======================
       FORM CONTROLS
    ======================= */
    .field label{
      display:block;
      font-size:12px;
      color:#444;
      margin-bottom:6px;
      font-weight:700;
    }

    .field input,
    .field textarea,
    .field select{
      width:100%;
      box-sizing:border-box;
      border:1px solid #ddd;
      border-radius:8px;
      padding:7px 12px;
      font-size:14px;
      outline:none;
    }

    .mini-label{
      display:block;
      font-size:12px;
      color:#444;
      margin-bottom:6px;
      font-weight:700;
    }

    /* =======================
       CRÉDITOS
    ======================= */
    .creditos-toolbar{
      display:flex;
      gap:12px;
      align-items:flex-end;
      margin-bottom:10px;
    }

    .creditos-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }

    @media (max-width: 760px){
      .creditos-grid{ grid-template-columns: 1fr; }
    }

    .creditos-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
    }

    .creditos-header > label{
      font-size:12px;
      font-weight:700;
      color:#444;
    }

    .creditos-selector{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:12px;
      color:#555;
    }

    .creditos-selector select{
      width:auto;
      padding:4px 8px;
      font-size:12px;
      border-radius:6px;
    }

    /* =======================
       ACCIONES
    ======================= */
    .actions{
      display:flex;
      gap:10px;
      justify-content:flex-end;
      margin-top:14px;
    }

    button{
      border:0;
      border-radius:10px;
      padding:10px 14px;
      font-weight:800;
      cursor:pointer;
    }

    .btn-primary{
      background:#111;
      color:#fff;
    }

    .btn-ghost{
      background:#eee;
      color:#111;
    }

    .hint{
      font-size:12px;
      color:#666;
      margin:10px 0 0;
    }

    .hidden{
      display:none !important;
    }

    @media print {
      body { background: #fff !important; }
      .app-bar, #panelFormulario { display: none !important; }
      #panelCarta { display: block !important; }
      .hoja {
        margin: 0 !important;
        box-shadow: none !important;
        width: 21.59cm !important;
        height: 27.94cm !important;
      }
    }
    
    @page {
      size: Letter;
      margin: 0;
    }
</style>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
</head>
<body>

  <div class="app-bar">
      <div class="brand">DOCUMENTOS FAST</div>
      <div>
        <button class="btn-ghost" id="btnEditar" type="button">Editar datos</button>
        <button class="btn-primary hidden" id="btnImprimir" type="button">GUARDAR PDF</button>
      </div>
  </div>

  <!-- Formulario -->
  <section class="panel" id="panelFormulario">
    <form id="formCarta">
      <div class="grid">
        <div class="field field-creditos">
          <div class="creditos-header">
            <label>Créditos (lista o códigos)</label>

            <div class="creditos-selector">
              <span>Cantidad</span>
              <select id="CREDITOS_COUNT">
                <option value="1" selected>1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
            </div>
          </div>

          <div class="creditos-grid" id="CREDITOS_CONTAINER">
            <input id="CREDITOS_1" type="text" placeholder="Crédito 1">
            <input id="CREDITOS_2" type="text" placeholder="Crédito 2">
            <input id="CREDITOS_3" type="text" placeholder="Crédito 3">
            <input id="CREDITOS_4" type="text" placeholder="Crédito 4">
            <input id="CREDITOS_5" type="text" placeholder="Crédito 5">
          </div>
        </div>
<div class="field">
      <label for="DNI">DNI</label>
      <input id="DNI" type="text" value="" placeholder="Ingresa DNI">
    </div>
<div class="field">
          <label for="ENTIDAD">Entidad (banco / empresa)</label>
          <select id="ENTIDAD">
            <option value="">Selecciona una entidad...</option>
<option value="Caja Municipal de Ahorro y Crédito de Arequipa S.A.">Caja Municipal de Ahorro y Crédito de Arequipa S.A.</option>
<option value="Banco de la Nación">Banco de la Nación</option>
<option value="Banco BBVA Perú">Banco BBVA Perú</option>
<option value="Financiera Credinka S.A.">Financiera Credinka S.A.</option>
<option value="Caja Rural de Ahorro y Crédito del Centro S.A.">Caja Rural de Ahorro y Crédito del Centro S.A.</option>
<option value="Banco Internacional del Perú S.A.A. – Interbank">Banco Internacional del Perú S.A.A. – Interbank</option>
<option value="Caja Rural de Ahorro y Crédito Los Andes S.A.">Caja Rural de Ahorro y Crédito Los Andes S.A.</option>
<option value="Mibanco – Banco de la Microempresa S.A.">Mibanco – Banco de la Microempresa S.A.</option>
<option value="Financiera ProEmpresa S.A.">Financiera ProEmpresa S.A.</option>
<option value="Financiera Qaqap S.A.C.">Financiera Qaqap S.A.C.</option>
<option value="Caja Municipal de Ahorro y Crédito de Sullana S.A.">Caja Municipal de Ahorro y Crédito de Sullana S.A.</option>
<option value="Banco Scotiabank Perú S.A.A.">Banco Scotiabank Perú S.A.A.</option>
          </select>
        </div>
<div class="field">
          <label for="FECHA_CASTIGO">Fecha de cesión / castigo</label>
          <input id="FECHA_CASTIGO" type="date" value="">
        </div>
<div class="field">
          <label for="FECHA_HOY">Fecha de emisión</label>
          <input id="FECHA_HOY" type="date" value="">
        </div>
<div class="field">
          <label for="FECHA_PAGO">Fecha de pago</label>
          <input id="FECHA_PAGO" type="date" value="">
        </div>
<div class="field">
      <label for="NOMBRE">Nombre completo</label>
      <input id="NOMBRE" type="text" value="" placeholder="Ingresa Nombre completo">
    </div>
<div class="field">
      <label for="plural">plural</label>
      <input id="plural" type="text" value="" placeholder="Ingresa plural">
    </div>
<div class="field">
      <label for="singular">singular</label>
      <input id="singular" type="text" value="" placeholder="Ingresa singular">
    </div>
      </div>

      <div class="actions">
        <button class="btn-primary" type="submit">GENERAR CARTA</button>
      </div>

      <p class="hint">Completa los campos y presiona <b>GENERAR CARTA</b> para ver la carta.</p>
    </form>
  </section>

  <!-- Carta -->
  <section id="panelCarta" class="hidden">
    <div id="renderCarta"></div>
  </section>

  <template id="tplCarta">
  <main class="hoja">
    <header class="doc-header">
      <div class="header-top">
        <img class="logo" src="images/LOGO_home.jpg" alt="Logo">
      </div>

          <div class="fecha">
        Santiago de Surco, {{FECHA_HOY}}
      </div>
    </header>

    <div class="titulo">CONSTANCIA DE NO ADEUDO - {{DNI}}</div>

    <section class="saludo">
      <p>A QUIEN CORRESPONDA</p>
    </section>

    <section class="cuerpo">
      <p>
        Por medio de la presente, le informamos que EXPÉRTIS MASTER SERVICER AND COLLECTIONS S.A.C., identificada con R.U.C. Nº 20600558481, con domicilio en Av. Circunvalación del Club Golf Los Incas N°154 - Oficina 403, distrito de Santiago de Surco, provincia y departamento de Lima, debidamente representada por Nathaly Isabel Jimenez Quispe según poderes inscritos en la partida N° 13459121, ha adquirido los derechos de la cartera de crédito otorgado por {{ENTIDAD}}, con base en el contrato de transferencia de cartera suscrito el {{FECHA_CASTIGO}}.
      </p>
      <p>
        Al respecto informamos que {{singular}}el{{/singular}}{{plural}}los{{/plural}} {{singular}}crédito{{/singular}}{{plural}}créditos{{/plural}} {{CREDITOS}} {{singular}}correspondiente{{/singular}}{{plural}}correspondientes{{/plural}} al Sr.(a) {{NOMBRE}}, identificado(a) con DNI N° {{DNI}}, {{singular}}ha{{/singular}} {{plural}}han{{/plural}} sido {{singular}}cancelado{{/singular}} {{plural}}cancelados{{/plural}} en su totalidad el día {{FECHA_PAGO}}, no existiendo a la fecha saldo pendiente de pago, por lo que se da por cancelada la deuda. Cabe mencionar que si {{singular}}el{{/singular}} {{plural}}los{{/plural}} {{singular}}crédito{{/singular}} {{plural}}créditos{{/plural}} en mención {{singular}}cuenta{{/singular}} {{plural}}cuentan{{/plural}} con un proceso judicial será responsabilidad única y exclusivamente del cliente asumir y realizar de manera total con todas las gestiones y los gastos notariales, registrales, tributarios y otros pertinentes que originen la formalización de la conclusión del proceso judicial, levantamiento de embargo y/o levantamiento de hipoteca¹.
      </p>
      <p>
        Se expide en Lima el {{FECHA_HOY}}, y se imprimió en Lima el {{FECHA_HOY}}.
      </p>
      <p>
        Sin otro particular, quedamos de ustedes.
      </p>
      <p>Atentamente,</p>
    </section>

    <section class="despedida">
      <p>EXPÉRTIS MASTER SERVICER & COLLECTIONS SAC</p>
    </section>

    <!-- FIRMA (imagen) -->
    <section class="firma">
      <img class="firma-img" src="images/FIRMA_nathaly.jpg" alt="Firma">
      <div class="firma-nombre">Nathaly Isabel Jimenez Quispe</div>
      <div class="firma-cargo">Apoderada</div>
    </section>

    <section class="nota">
      <small>
        (1) Para concluir cualquier proceso judicial deberá interponerse el trámite correspondiente, que ayudará al cliente a reducir el trámite de manera idónea. Por el lado de la hipoteca se tendrá en cuenta que ha sido judicial, además, se solicita la cuenta de levantamiento del gravamen.
      </small>
    </section>

  </main>
  </template>

<script>
  const placeholders = ["CREDITOS", "DNI", "ENTIDAD", "FECHA_CASTIGO", "FECHA_HOY", "FECHA_PAGO", "NOMBRE", "plural", "singular"];
  const creditosCount = document.getElementById('CREDITOS_COUNT');
  const creditosContainer = document.getElementById('CREDITOS_CONTAINER');
  const panelFormulario = document.getElementById('panelFormulario');
  const panelCarta = document.getElementById('panelCarta');
  const renderCarta = document.getElementById('renderCarta');
  const tplCarta = document.getElementById('tplCarta');
  const btnEditar = document.getElementById('btnEditar');
  const form = document.getElementById('formCarta');
  const MONTHS_ES = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Setiembre','Octubre','Noviembre','Diciembre'];
  
  function showForm() {
    panelFormulario.classList.remove('hidden');
    panelCarta.classList.add('hidden');
    btnImprimir?.classList.add('hidden'); // ✅ seguro
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function showCarta() {
    panelFormulario.classList.add('hidden');
    panelCarta.classList.remove('hidden');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function syncCreditosInputs() {
    if (!creditosCount || !creditosContainer) return;
    const n = Math.max(1, Math.min(5, Number(creditosCount.value || 1)));
    for (let i = 1; i <= 5; i++) {
      const inp = document.getElementById(`CREDITOS_${i}`);
      if (!inp) continue;
      const visible = i <= n;
      inp.classList.toggle('hidden', !visible);
      if (!visible) inp.value = '';
    }
  }

  function buildCreditosString() {
    if (!creditosCount) return '';
    const n = Math.max(1, Math.min(5, Number(creditosCount.value || 1)));
    const vals = [];
    for (let i = 1; i <= n; i++) {
      const v = (document.getElementById(`CREDITOS_${i}`)?.value || '').trim();
      if (v) vals.push(v);
    }
    return vals.join(', ');
  }
    
  function applySingularPluralByCreditos(text) {
      const n = Number(document.getElementById('CREDITOS_COUNT')?.value || 1);
      const isSingular = (n === 1);
      const reSing = /\{\{\s*singular\s*\}\}([\s\S]*?)\{\{\s*\/singular\s*\}\}/gi;
      const rePlur = /\{\{\s*plural\s*\}\}([\s\S]*?)\{\{\s*\/plural\s*\}\}/gi;
    
      if (isSingular) {
        text = text.replace(reSing, '$1');
        text = text.replace(rePlur, '');
      } else {
        text = text.replace(rePlur, '$1');
        text = text.replace(reSing, '');
      }
      return text;
  }

  function applyTemplate(templateStr, data) {
    return templateStr.replace(/\{\{\s*([A-Za-z0-9_]+)\s*\}\}/g, (match, key) => {
      const v = data[key];
      return (v === undefined || v === null || v === '') ? match : String(v);
    });
  }

  function isoToLongEs(iso) {
    if (!iso) return '';
    const m = String(iso).match(/^(\d{4})-(\d{2})-(\d{2})$/);
    if (!m) return ''; // si viniera raro, no formatees
    const yyyy = Number(m[1]);
    const mm = Number(m[2]); // 1-12
    const dd = Number(m[3]);
    if (!yyyy || mm < 1 || mm > 12 || dd < 1 || dd > 31) return '';
    return `${dd} de ${MONTHS_ES[mm - 1]} de ${yyyy}`;
  }

  function collectData() {
    const data = {};
    for (const key of placeholders) {
      if (key === 'CREDITOS') {
        data[key] = buildCreditosString();
        continue;
      }
      const el = document.getElementById(key);
      if (!el) continue;
      let v = (el.value || '').trim();
      if (key === 'FECHA_HOY' || key === 'FECHA_CASTIGO' || key === 'FECHA_PAGO') {
        v = isoToLongEs(v);
      }
      data[key] = v;
    }
    return data;
  }

  btnEditar?.addEventListener('click', showForm);
  creditosCount?.addEventListener('change', syncCreditosInputs);
  syncCreditosInputs();

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const data = collectData();

    if (('FECHA_HOY' in data) && !data.FECHA_HOY) {
      const d = new Date();
      const iso =
        `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
      data.FECHA_HOY = isoToLongEs(iso);
    }
    
    const tplRaw = tplCarta.innerHTML;
    const tplFixed = applySingularPluralByCreditos(tplRaw);
    renderCarta.innerHTML = applyTemplate(tplFixed, data);

    showCarta();
    btnImprimir?.classList.remove('hidden'); // ✅ mostrar botón
  });

  const btnImprimir = document.getElementById('btnImprimir');
    
    function showCarta() {
      panelFormulario.classList.add('hidden');
      panelCarta.classList.remove('hidden');
      btnImprimir?.classList.remove('hidden');   // ✅
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    btnImprimir?.addEventListener('click', () => {
      window.print(); // ✅ El navegador permite "Guardar como PDF" con texto seleccionable
  });
</script>

</body>
</html>